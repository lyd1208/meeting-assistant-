<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ğŸ™ï¸ ä¼šè®®åŠ©æ‰‹ - åœ¨çº¿ç‰ˆ</title>
    <style>
        body {
            font-family: 'å¾®è½¯é›…é»‘', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-red {
            background: #e53e3e;
        }
        .btn-green {
            background: #38a169;
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            margin: 15px 0;
        }
        .section {
            margin: 25px 0;
            padding: 20px;
            background: #f7fafc;
            border-radius: 15px;
        }
        h3 {
            color: #667eea;
            margin-top: 0;
        }
        #summary, #tasks {
            line-height: 1.8;
            font-size: 15px;
            min-height: 60px;
        }
        .status {
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
            min-height: 20px;
            color: #e53e3e;
        }
        .live-text {
            font-size: 18px;
            line-height: 1.6;
            padding: 10px;
            background: #e2e8f0;
            border-radius: 8px;
            min-height: 60px;
        }
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #667eea;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .guide {
            background: #e2e8f0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ ä¼šè®®åŠ©æ‰‹ - åœ¨çº¿ç‰ˆ</h1>

        <div class="guide">
            <h3>ğŸ“Œ ä½¿ç”¨è¯´æ˜</h3>
            <ol>
                <li>ç‚¹å‡» <strong>ğŸ¤ å¼€å§‹è¯´è¯</strong>ï¼Œè¯´å‡ºä¼šè®®å†…å®¹</li>
                <li>è¯´å®Œåç‚¹å‡» <strong>â¹ï¸ åœæ­¢è¯†åˆ«</strong></li>
                <li>ç‚¹å‡» <strong>ç”Ÿæˆä¼šè®®çºªè¦</strong>ï¼ŒAI è‡ªåŠ¨æ•´ç†</li>
            </ol>
            <p>ğŸ’¡ æ— éœ€å®‰è£…ï¼ŒAI ç”±äº‘ç«¯é©±åŠ¨</p>
        </div>

        <div class="section">
            <h3>ğŸ™ï¸ å®æ—¶è¯­éŸ³è¯†åˆ«</h3>
            <button onclick="startRealTimeRecognition()" class="btn">ğŸ¤ å¼€å§‹è¯´è¯</button>
            <button onclick="stopRecognition()" class="btn btn-red">â¹ï¸ åœæ­¢è¯†åˆ«</button>
            <div class="status" id="status"></div>
        </div>

        <div class="section">
            <h3>ğŸ“ å®æ—¶è½¬å†™ç»“æœ</h3>
            <div id="liveTranscript" class="live-text">è¯†åˆ«ç»“æœå°†å®æ—¶æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
        </div>

        <div class="section">
            <h3>ğŸ“ æœ€ç»ˆä¼šè®®å†…å®¹</h3>
            <textarea id="transcript" placeholder="å®Œæ•´çš„ä¼šè®®è®°å½•ä¼šåˆå¹¶åˆ°è¿™é‡Œ..."></textarea>
        </div>

        <div class="section">
            <h3>âœ¨ æ™ºèƒ½å¤„ç†</h3>
            <button onclick="generateSummary()" class="btn" id="summaryBtn">ç”Ÿæˆä¼šè®®çºªè¦</button>
            <button onclick="extractTasks()" class="btn">æå–ä»»åŠ¡</button>
        </div>

        <div class="section">
            <h3>ğŸ“Š ä¼šè®®çºªè¦</h3>
            <div id="summary">ç‚¹å‡»â€œç”Ÿæˆä¼šè®®çºªè¦â€æŒ‰é’®ï¼ŒAI å°†åˆ†æå†…å®¹å¹¶ç”Ÿæˆç»“æ„åŒ–çºªè¦...</div>
        </div>

        <div class="section">
            <h3>âœ… ä»»åŠ¡æ¸…å•</h3>
            <div id="tasks">ç‚¹å‡»â€œæå–ä»»åŠ¡â€æŒ‰é’®ï¼ŒAI å¯æå–å¾…åŠäº‹é¡¹...</div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ Web Speech API
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            alert("âš ï¸ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«ï¼Œè¯·ä½¿ç”¨ Chrome æˆ– Edge");
        }

        const recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = 'zh-CN';

        let finalTranscript = '';

        function startRealTimeRecognition() {
            const status = document.getElementById('status');
            try {
                recognition.start();
                status.textContent = "ğŸŸ¢ æ­£åœ¨è¯†åˆ«... è¯·å¼€å§‹è¯´è¯";
                document.getElementById('liveTranscript').textContent = "";
                document.getElementById('transcript').value = "";
                finalTranscript = '';
            } catch (error) {
                status.textContent = "âŒ å¯åŠ¨å¤±è´¥: " + error.message;
            }
        }

        function stopRecognition() {
            recognition.stop();
            document.getElementById('status').textContent = "âœ… è¯†åˆ«å·²åœæ­¢";
        }

        recognition.onresult = (event) => {
            let interimTranscript = '';
            finalTranscript = '';

            for (let i = event.resultIndex; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    finalTranscript += transcript + ' ';
                } else {
                    interimTranscript = transcript;
                }
            }

            document.getElementById('liveTranscript').textContent = interimTranscript;
            const finalText = (document.getElementById('transcript').value + finalTranscript).trim();
            document.getElementById('transcript').value = finalText || '';
        };

        recognition.onerror = (event) => {
            document.getElementById('status').textContent = "âŒ è¯†åˆ«é”™è¯¯: " + event.error;
        };

        recognition.onend = () => {
            document.getElementById('status').textContent = "â¹ï¸ è¯†åˆ«å·²ç»“æŸï¼ˆå¦‚éœ€ç»§ç»­ï¼Œè¯·ç‚¹å‡»å¼€å§‹ï¼‰";
        };

        // âœ… ä¿®æ”¹ï¼šè°ƒç”¨æœ¬åœ° /api/generateï¼Œç”± Vercel ä»£ç†è½¬å‘åˆ°é˜¿é‡Œäº‘
        async function generateSummary() {
            const transcript = document.getElementById('transcript').value.trim();
            if (!transcript) {
                alert("è¯·å…ˆå½•éŸ³è·å–å†…å®¹ï¼");
                return;
            }

            const summaryDiv = document.getElementById('summary');
            const btn = document.getElementById('summaryBtn');

            btn.disabled = true;
            btn.textContent = '';
            summaryDiv.innerHTML = '<span class="loading"></span> AI æ­£åœ¨ç”Ÿæˆä¼šè®®çºªè¦...';

            try {
                const MAX_LENGTH = 1000;
                const content = transcript.length > MAX_LENGTH 
                    ? transcript.substring(0, MAX_LENGTH) + "..." 
                    : transcript;

                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content: content,
                        type: 'summary'
                    })
                });

                const data = await res.json();
                if (data.text) {
                    summaryDiv.innerHTML = data.text;
                } else {
                    summaryDiv.innerHTML = `âŒ AI é”™è¯¯ï¼š${data.error || JSON.stringify(data)}`;
                }
            } catch (error) {
                summaryDiv.innerHTML = `âŒ è¯·æ±‚å¤±è´¥ï¼š${error.message}`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'ç”Ÿæˆä¼šè®®çºªè¦';
            }
        }

        async function extractTasks() {
            const transcript = document.getElementById('transcript').value.trim();
            if (!transcript) {
                alert("è¯·å…ˆå½•éŸ³è·å–å†…å®¹ï¼");
                return;
            }

            const tasksDiv = document.getElementById('tasks');
            tasksDiv.innerHTML = '<span class="loading"></span> AI æ­£åœ¨æå–ä»»åŠ¡...';

            try {
                const content = transcript.substring(0, 800) + "...";

                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content: content,
                        type: 'task'
                    })
                });

                const data = await res.json();
                if (data.text) {
                    tasksDiv.innerHTML = `<pre>${data.text}</pre>`;
                } else {
                    tasksDiv.innerHTML = `âŒ æå–å¤±è´¥ï¼š${data.error || JSON.stringify(data)}`;
                }
            } catch (error) {
                tasksDiv.innerHTML = `âŒ æå–å¤±è´¥ï¼š${error.message}`;
            }
        }
    </script>
</body>
</html>